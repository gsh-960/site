# SQL代码格式化工作技巧文档

## 需求背景

在日常工作中，我们经常遇到SQL代码存在过多空行的情况，影响代码的整洁性和可读性。特别是从不同来源获取的SQL脚本，可能存在每行代码后紧跟多个空行的问题，需要进行统一的格式化处理。

## 操作目标

去除SQL语句中每行有效内容后的第一个空行，保持代码整体结构清晰，提高代码可读性。

## 解决方案

### 方案一：使用IntelliJ IDEA/PyCharm正则表达式替换

#### 操作步骤：
1. 在IDEA/PyCharm中打开需要处理的SQL文件
2. 按下快捷键 `Ctrl+R` (Windows/Linux) 或 `Cmd+R` (Mac) 打开替换窗口
3. 点击替换窗口左上角的 [.*](file://D:\project\apl_mi\new_kzt_gaosh\20251014客服系统工单表数据清洗\data_back\区县字段更新.xlsx) 图标启用正则表达式模式
4. 在"查找"框中输入正则表达式：
   ```
   (\S.*)\n\s*\n(\s*\S)
   ```

5. 在"替换为"框中输入：
   ```
   $1\n$2
   ```

6. 点击"全部替换"按钮完成批量处理

#### 正则表达式说明：
- [(\S.*)](file://D:\project\apl_mi\new_kzt_gaosh\政策捕获\policy_order_hit.py#L0-L891)：捕获组1，匹配以非空白字符开头的一整行内容
- `\n\s*\n`：匹配两个换行符之间的任意空白字符（即单个空行）
- [(\s*\S)](file://D:\project\apl_mi\new_kzt_gaosh\CSC测试环境数据同步\csc_data_sync.py#L8-L598)：捕获组2，匹配下一行内容中第一个非空白字符及其前面的空白字符
- `$1\n$2`：替换为捕获组1 + 换行符 + 捕获组2，相当于去除了中间的空行

#### 替代正则表达式：
如果上述表达式不够精确，也可以使用：
- 查找：[(.*[^\s].*)\n\s*\n(\s*.*[^\s])](file://D:\project\apl_mi\new_kzt_gaosh\CSC测试环境数据同步\csc_data_sync.py#L21-L21)
- 替换为：`$1\n$2`

该表达式更加严格地匹配包含至少一个非空白字符的行。

### 方案二：手动编辑
对于少量文件或者特殊情况，可以直接手动删除多余的空行。

## 实际效果示例

处理前：
```sql
SELECT
    column1,
    
    column2,
    

    column3
FROM table_name;
```


处理后：
```sql
SELECT
    column1,
    column2,
    
    column3
FROM table_name;
```


注意：只会去除每行内容后的第一个空行，保留第二个及之后的空行，以维持必要的代码分段结构。